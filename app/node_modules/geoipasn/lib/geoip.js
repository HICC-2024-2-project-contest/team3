"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,exports.query=query;var _fs=_interopRequireDefault(require("fs")),_ip=_interopRequireDefault(require("@amuject/ip")),_asn=_interopRequireDefault(require("./asn.js")),_geoipLite=_interopRequireDefault(require("geoip-lite")),_path=_interopRequireDefault(require("path")),_url=require("url");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const ___filename=(0,_url.fileURLToPath)(require("url").pathToFileURL(__filename).toString()),___dirname=_path.default.dirname(___filename),alpha2=JSON.parse(_fs.default.readFileSync(_path.default.resolve(___dirname,"../data/ISO-3166-1-alpha-2.json"))),regions=JSON.parse(_fs.default.readFileSync(_path.default.resolve(___dirname,"../data/ISO-3166-1-alpha-2-regions.json"))),serviceRanges=JSON.parse(_fs.default.readFileSync(_path.default.resolve(___dirname,"../data/IPv4-service-ranges.json")));function query(ip){"string"==typeof ip&&(ip=new _ip.default(ip));let result={ip:ip,country:{code:"XX",name:"Unknown"},region:null,city:null,coordinate:{latitude:null,longtitude:null,range:null},timezone:null,time:null,as:{number:null,name:null},service:null};const match=/^((?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:[\da-f]{4}\:[\da-f]{4}\:[\da-f]{4}\:[\da-f]{4}\:[\da-f]{4}\:[\da-f]{4}\:[\da-f]{4}\:[\da-f]{4}))?$/.exec(ip);if(!match)return result;result.service=getService(ip);let bogon=ip.getBogon();bogon&&(result.country.name=bogon,result.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,result.time=new Date(new Date().toLocaleString("en-US",{timeZone:result.timezone}))),bogon?result.country.name=bogon:null;let data=_geoipLite.default.lookup(ip.label);if(!data)return result;result.country.code=data.country,result.country.name=alpha2[data?.country]?alpha2[data.country]:data.country,result.region=regions?.[data?.country]?.[data?.region]?regions[data.country][data.region]:data.region,result.city=data?.city?data.city:"",result.coordinate.latitude=data?.ll[0]?data.ll[0]:-1,result.coordinate.longtitude=data?.ll[1]?data.ll[1]:-1,result.coordinate.range=data?.area?data.area:-1,result.timezone=data?.timezone?data.timezone:"UTC",result.time=new Date(new Date().toLocaleString("en-US",{timeZone:result.timezone}));let asnData=(0,_asn.default)(ip);return delete asnData.ip,result.as=asnData,result}query.asn=_asn.default;function getService(ip){for(const key in serviceRanges)if(ip.in(new _ip.default(key)))return serviceRanges[key];return""}var _default=exports.default=query;